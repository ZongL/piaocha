<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>费用分析 - 医保票据解析助手</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        .medical-gradient {
            background: linear-gradient(135deg, #2563eb 0%, #10b981 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .chart-container {
            height: 300px;
        }
        .tab-active {
            background: linear-gradient(135deg, #2563eb 0%, #10b981 100%);
            color: white;
        }
    </style>
</head>
<body class="min-h-screen pb-20">
    <!-- 顶部导航 -->
    <div class="medical-gradient text-white p-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <button onclick="history.back()" class="w-8 h-8 flex items-center justify-center">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
                <div>
                    <h1 class="text-lg font-bold">费用分析</h1>
                    <p class="text-blue-100 text-sm">人民医院门诊发票</p>
                </div>
            </div>
            <div class="text-right">
                <p class="text-sm text-blue-100">2024-01-15</p>
                <p class="text-xs text-blue-100">NO.1234567890</p>
            </div>
        </div>
    </div>

    <!-- 主要内容区域 -->
    <div class="px-4 py-6 space-y-6">
        <!-- 费用概览 -->
        <div class="bg-white rounded-2xl p-6 card-shadow">
            <h2 class="text-lg font-bold text-gray-800 mb-4">费用概览</h2>
            
            <div class="grid grid-cols-3 gap-4 mb-6">
                <div class="text-center p-4 bg-gray-50 rounded-xl">
                    <div class="text-2xl font-bold text-gray-800 mb-1">¥268.50</div>
                    <div class="text-sm text-gray-600">总费用</div>
                </div>
                <div class="text-center p-4 bg-blue-50 rounded-xl">
                    <div class="text-2xl font-bold text-blue-600 mb-1">¥201.75</div>
                    <div class="text-sm text-gray-600">医保支付</div>
                </div>
                <div class="text-center p-4 bg-orange-50 rounded-xl">
                    <div class="text-2xl font-bold text-orange-600 mb-1">¥66.75</div>
                    <div class="text-sm text-gray-600">个人支付</div>
                </div>
            </div>
            
            <div class="bg-gray-50 rounded-xl p-4">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm text-gray-600">报销比例</span>
                    <span class="text-sm font-medium text-green-600">75.1%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full" style="width: 75.1%"></div>
                </div>
            </div>
        </div>

        <!-- 图表切换标签 -->
        <div class="bg-white rounded-2xl p-4 card-shadow">
            <div class="flex space-x-2 mb-4">
                <button id="pieTab" class="tab-active flex-1 py-2 px-4 rounded-xl text-sm font-medium transition-all">
                    费用构成
                </button>
                <button id="barTab" class="flex-1 py-2 px-4 rounded-xl text-sm font-medium text-gray-600 bg-gray-100 transition-all">
                    明细对比
                </button>
                <button id="trendTab" class="flex-1 py-2 px-4 rounded-xl text-sm font-medium text-gray-600 bg-gray-100 transition-all">
                    趋势分析
                </button>
            </div>
            
            <!-- 饼图 -->
            <div id="pieChart" class="chart-container"></div>
            
            <!-- 柱状图 -->
            <div id="barChart" class="chart-container hidden"></div>
            
            <!-- 趋势图 -->
            <div id="trendChart" class="chart-container hidden"></div>
        </div>

        <!-- 费用明细 -->
        <div class="bg-white rounded-2xl p-6 card-shadow">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-800">费用明细</h3>
                <button class="text-blue-600 text-sm font-medium">导出明细</button>
            </div>
            
            <div class="space-y-3">
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                            </svg>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">西药费</p>
                            <p class="text-sm text-gray-600">阿莫西林胶囊等</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-gray-800">¥125.00</p>
                        <p class="text-xs text-green-600">医保 ¥100.00</p>
                    </div>
                </div>
                
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                            </svg>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">中成药费</p>
                            <p class="text-sm text-gray-600">感冒清热颗粒等</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-gray-800">¥68.50</p>
                        <p class="text-xs text-green-600">医保 ¥54.80</p>
                    </div>
                </div>
                
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                            </svg>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">检查费</p>
                            <p class="text-sm text-gray-600">血常规检查等</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-gray-800">¥45.00</p>
                        <p class="text-xs text-green-600">医保 ¥36.00</p>
                    </div>
                </div>
                
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">诊疗费</p>
                            <p class="text-sm text-gray-600">普通门诊诊查费</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-gray-800">¥30.00</p>
                        <p class="text-xs text-green-600">医保 ¥10.95</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 对比分析 -->
        <div class="bg-white rounded-2xl p-6 card-shadow">
            <h3 class="text-lg font-bold text-gray-800 mb-4">同期对比</h3>
            
            <div class="space-y-4">
                <div class="flex items-center justify-between p-4 bg-blue-50 rounded-xl">
                    <div>
                        <p class="font-medium text-gray-800">本月总费用</p>
                        <p class="text-sm text-gray-600">相比上月</p>
                    </div>
                    <div class="text-right">
                        <p class="text-2xl font-bold text-blue-600">¥268.50</p>
                        <p class="text-sm text-green-600">↓ 12.5%</p>
                    </div>
                </div>
                
                <div class="flex items-center justify-between p-4 bg-green-50 rounded-xl">
                    <div>
                        <p class="font-medium text-gray-800">医保报销比例</p>
                        <p class="text-sm text-gray-600">本月平均</p>
                    </div>
                    <div class="text-right">
                        <p class="text-2xl font-bold text-green-600">75.1%</p>
                        <p class="text-sm text-green-600">↑ 3.2%</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 智能建议 -->
        <div class="bg-white rounded-2xl p-6 card-shadow">
            <h3 class="text-lg font-bold text-gray-800 mb-4">智能建议</h3>
            
            <div class="space-y-3">
                <div class="flex items-start space-x-3 p-3 bg-green-50 rounded-xl">
                    <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                        <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div>
                        <p class="font-medium text-gray-800">报销比例良好</p>
                        <p class="text-sm text-gray-600">本次医保报销比例达到75.1%，高于平均水平</p>
                    </div>
                </div>
                
                <div class="flex items-start space-x-3 p-3 bg-blue-50 rounded-xl">
                    <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                        <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div>
                        <p class="font-medium text-gray-800">费用控制建议</p>
                        <p class="text-sm text-gray-600">本月医疗费用较上月有所下降，建议继续保持</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部导航栏 -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2 z-50">
        <div class="flex items-center justify-around">
            <a href="index.html" class="flex flex-col items-center space-y-1 text-gray-400">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                </svg>
                <span class="text-xs">首页</span>
            </a>
            
            <a href="analysis.html" class="flex flex-col items-center space-y-1 text-blue-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                <span class="text-xs font-medium">分析</span>
            </a>
            
            <a href="history.html" class="flex flex-col items-center space-y-1 text-gray-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                </svg>
                <span class="text-xs">记录</span>
            </a>
            
            <a href="profile.html" class="flex flex-col items-center space-y-1 text-gray-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                <span class="text-xs">我的</span>
            </a>
        </div>
    </div>

    <script>
        // 页面加载动画
        anime({
            targets: '.card-shadow',
            translateY: [50, 0],
            opacity: [0, 1],
            delay: anime.stagger(100),
            duration: 800,
            easing: 'easeOutExpo'
        });

        // 图表数据
        const chartData = {
            pie: {
                title: '费用构成分析',
                data: [
                    {value: 201.75, name: '医保支付', itemStyle: {color: '#2563eb'}},
                    {value: 66.75, name: '个人支付', itemStyle: {color: '#f59e0b'}}
                ]
            },
            bar: {
                title: '费用明细对比',
                categories: ['西药费', '中成药费', '检查费', '诊疗费'],
                medical: [100.00, 54.80, 36.00, 10.95],
                personal: [25.00, 13.70, 9.00, 19.05]
            },
            trend: {
                title: '费用趋势分析',
                categories: ['10月', '11月', '12月', '1月'],
                total: [320.50, 285.30, 310.20, 268.50],
                medical: [240.38, 213.98, 232.65, 201.75],
                personal: [80.12, 71.32, 77.55, 66.75]
            }
        };

        // 初始化图表
        let pieChart, barChart, trendChart;

        function initCharts() {
            // 饼图
            pieChart = echarts.init(document.getElementById('pieChart'));
            const pieOption = {
                title: {
                    text: '费用构成',
                    left: 'center',
                    textStyle: {
                        fontSize: 16,
                        fontWeight: 'bold',
                        color: '#374151'
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: ¥{c} ({d}%)'
                },
                legend: {
                    bottom: 10,
                    left: 'center'
                },
                series: [
                    {
                        name: '费用构成',
                        type: 'pie',
                        radius: ['40%', '70%'],
                        center: ['50%', '45%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: true,
                            formatter: '{b}\n¥{c} ({d}%)'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '14',
                                fontWeight: 'bold'
                            }
                        },
                        data: chartData.pie.data
                    }
                ]
            };
            pieChart.setOption(pieOption);

            // 柱状图
            barChart = echarts.init(document.getElementById('barChart'));
            const barOption = {
                title: {
                    text: '费用明细对比',
                    left: 'center',
                    textStyle: {
                        fontSize: 16,
                        fontWeight: 'bold',
                        color: '#374151'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    },
                    formatter: function(params) {
                        let result = params[0].name + '<br/>';
                        params.forEach(function(item) {
                            result += item.seriesName + ': ¥' + item.value + '<br/>';
                        });
                        return result;
                    }
                },
                legend: {
                    data: ['医保支付', '个人支付'],
                    bottom: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: chartData.bar.categories,
                    axisLabel: {
                        interval: 0,
                        rotate: 0
                    }
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: '¥{value}'
                    }
                },
                series: [
                    {
                        name: '医保支付',
                        type: 'bar',
                        stack: 'total',
                        data: chartData.bar.medical,
                        itemStyle: {
                            color: '#2563eb',
                            borderRadius: [4, 4, 0, 0]
                        }
                    },
                    {
                        name: '个人支付',
                        type: 'bar',
                        stack: 'total',
                        data: chartData.bar.personal,
                        itemStyle: {
                            color: '#f59e0b',
                            borderRadius: [0, 0, 0, 0]
                        }
                    }
                ]
            };
            barChart.setOption(barOption);

            // 趋势图
            trendChart = echarts.init(document.getElementById('trendChart'));
            const trendOption = {
                title: {
                    text: '费用趋势分析',
                    left: 'center',
                    textStyle: {
                        fontSize: 16,
                        fontWeight: 'bold',
                        color: '#374151'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        let result = params[0].name + '<br/>';
                        params.forEach(function(item) {
                            result += item.seriesName + ': ¥' + item.value + '<br/>';
                        });
                        return result;
                    }
                },
                legend: {
                    data: ['总费用', '医保支付', '个人支付'],
                    bottom: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: chartData.trend.categories
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: '¥{value}'
                    }
                },
                series: [
                    {
                        name: '总费用',
                        type: 'line',
                        data: chartData.trend.total,
                        itemStyle: {
                            color: '#6b7280'
                        },
                        lineStyle: {
                            width: 3
                        }
                    },
                    {
                        name: '医保支付',
                        type: 'line',
                        data: chartData.trend.medical,
                        itemStyle: {
                            color: '#2563eb'
                        },
                        lineStyle: {
                            width: 3
                        }
                    },
                    {
                        name: '个人支付',
                        type: 'line',
                        data: chartData.trend.personal,
                        itemStyle: {
                            color: '#f59e0b'
                        },
                        lineStyle: {
                            width: 3
                        }
                    }
                ]
            };
            trendChart.setOption(trendOption);
        }

        // 标签切换功能
        function switchTab(tabName) {
            // 重置所有标签
            document.querySelectorAll('[id$="Tab"]').forEach(tab => {
                tab.className = tab.className.replace('tab-active', 'text-gray-600 bg-gray-100');
            });
            
            // 隐藏所有图表
            document.querySelectorAll('[id$="Chart"]').forEach(chart => {
                chart.classList.add('hidden');
            });
            
            // 激活选中的标签
            document.getElementById(tabName + 'Tab').className = document.getElementById(tabName + 'Tab').className.replace('text-gray-600 bg-gray-100', 'tab-active');
            
            // 显示对应的图表
            document.getElementById(tabName + 'Chart').classList.remove('hidden');
            
            // 重新渲染图表
            if (tabName === 'pie' && pieChart) {
                pieChart.resize();
            } else if (tabName === 'bar' && barChart) {
                barChart.resize();
            } else if (tabName === 'trend' && trendChart) {
                trendChart.resize();
            }
        }

        // 绑定标签点击事件
        document.getElementById('pieTab').addEventListener('click', () => switchTab('pie'));
        document.getElementById('barTab').addEventListener('click', () => switchTab('bar'));
        document.getElementById('trendTab').addEventListener('click', () => switchTab('trend'));

        // 页面加载完成后初始化图表
        window.addEventListener('load', function() {
            initCharts();
        });

        // 响应式处理
        window.addEventListener('resize', function() {
            if (pieChart) pieChart.resize();
            if (barChart) barChart.resize();
            if (trendChart) trendChart.resize();
        });

        // 底部导航处理
        document.querySelectorAll('a[href]').forEach(link => {
            link.addEventListener('click', function(e) {
                if (this.getAttribute('href') !== 'analysis.html' && this.getAttribute('href') !== 'index.html') {
                    e.preventDefault();
                    // 显示即将推出提示
                    const toast = document.createElement('div');
                    toast.className = 'fixed top-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg z-50';
                    toast.textContent = '功能即将推出';
                    document.body.appendChild(toast);
                    
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 2000);
                }
            });
        });
    </script>
</body>
</html>